#!/home/siana/.nvm/versions/node/v10.24.1/bin/node
var _a,_b,_c,_d,_e,_f,__runInitializers=this&&this.__runInitializers||function(e,t,r){for(var n=arguments.length>2,s=0;s<t.length;s++)r=n?t[s].call(e,r):t[s].call(e);return n?r:void 0},__esDecorate=this&&this.__esDecorate||function(e,t,r,n,s,o){function i(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var a,l=n.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?n.static?e:e.prototype:null,f=t||(u?Object.getOwnPropertyDescriptor(u,n.name):{}),h=!1,d=r.length-1;d>=0;d--){var p={};for(var y in n)p[y]="access"===y?{}:n[y];for(var y in n.access)p.access[y]=n.access[y];p.addInitializer=function(e){if(h)throw new TypeError("Cannot add initializers after decoration has completed");o.push(i(e||null))};var m=(0,r[d])("accessor"===l?{get:f.get,set:f.set}:f[c],p);if("accessor"===l){if(void 0===m)continue;if(null===m||"object"!=typeof m)throw new TypeError("Object expected");(a=i(m.get))&&(f.get=a),(a=i(m.set))&&(f.set=a),(a=i(m.init))&&s.unshift(a)}else(a=i(m))&&("field"===l?s.unshift(a):f[c]=a)}u&&Object.defineProperty(u,n.name,f),h=!0},__classPrivateFieldGet=this&&this.__classPrivateFieldGet||function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)},__classPrivateFieldSet=this&&this.__classPrivateFieldSet||function(e,t,r,n,s){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?s.call(e,r):s?s.value=r:t.set(e,r),r};"object"!=typeof globalThis&&(Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__),null!==(_a=Symbol.dispose)&&void 0!==_a||(Symbol.dispose=Symbol("dispose")),null!==(_b=Symbol.asyncDispose)&&void 0!==_b||(Symbol.asyncDispose=Symbol("asyncDispose")),null!==(_c=globalThis.system)&&void 0!==_c||(globalThis.system={args:process.argv.slice(1),exit:process.exit,readTextFileSync:e=>require("fs").readFileSync(e,{encoding:"utf8"}),writeTextFileSync(e,t){require("fs").writeFileSync(e,t,{encoding:"utf8"})},async createTextFileReadStream(e){const t=require("fs").createReadStream(e,{encoding:"utf8"});return await new Promise((function(e,r){t.on("readable",e),t.on("error",r)})),t[Symbol.dispose]=()=>{},t},async createTextFileWriteStream(e){const t=require("fs").createWriteStream(e,{encoding:"utf8"});return t[Symbol.dispose]=()=>{},t}}),null!==(_d=system.createTextFileReadStream)&&void 0!==_d||(system.createTextFileReadStream=async function(e){const t=system.openSync(e,{read:!0});return{read(e){const r=new Uint8Array(e);return t.readSync(r),(new TextDecoder).decode(r)},[Symbol.dispose](){t.close()}}}),null!==(_e=system.createTextFileWriteStream)&&void 0!==_e||(system.createTextFileWriteStream=async function(e){const t=system.openSync(e,{write:!0,create:!0});return{write(e){t.writeSync((new TextEncoder).encode(e))},[Symbol.dispose](){t.close()}}});const throws=e=>{throw e};function installPolyfill(e,t,r=!1){for(const[n,s]of Object.entries(t))n in e.prototype||Object.defineProperty(e.prototype,n,{value:s,configurable:r})}var ArrayPolyfill,ArrayConstructorPolyfill,AsyncIteratorPolyfill,AsyncIteratorShiftPolyfill,IteratorPolyfill,IteratorShiftPolyfill,ObjectPolyfill,ObjectConstructorPolyfill,SetPolyfill,InPlaceSetPolyfill,Graphviz,DecoratorFactory;!function(e){e.at=function(e){if((e*=1)>=0)return this[e];if(e<0)return this[this.length+e];throw new TypeError("Argument to at() is not a number")},e.flat=function e(t=1){return t?Array.prototype.reduce.call(this,(function(r,n){return Array.isArray(n)?r.push.apply(r,e.call(n,t-1)):r.push(n),r}),[]):Array.prototype.slice.call(this)},e.flatMap=function(e,t){return Array.prototype.map.call(this,e,t).flat()}}(ArrayPolyfill||(ArrayPolyfill={})),installPolyfill(Array,ArrayPolyfill),function(e){e.entries=function(e){return Array.prototype.map.apply(e,[(e,t)=>[t,e]])}}(ArrayConstructorPolyfill||(ArrayConstructorPolyfill={})),installPolyfill({prototype:Array},ArrayConstructorPolyfill),function(e){const t=Symbol();e.map=async function*(e){let t=0;for await(const r of this)yield e(r,t),t++},e.filter=async function*(e){let t=0;for await(const r of this)e(r,t)&&(yield r),t++},e.take=async function*(e){let t=0;for await(const r of this){if(t>=e)break;yield r,t++}},e.drop=async function*(e){let t=0;for await(const r of this)t>=e&&(yield r),t++},e.flatMap=async function*(e){let t=0;for await(const r of this)yield*e(r,t),t++},e.reduce=async function(e,r=t){let n=r,s=0;for await(const r of this)n!==t?(n=e(n,r,s),s++):n=r;if(n===t)throw new TypeError("Must specify an initialValue if the iterable is empty.");return n},e.toArray=async function(){const e=[];for await(const t of this)e.push(t);return e},e.forEach=async function(e){let t=0;for await(const r of this)e(r,t),t++},e.some=async function(e){let t=0;for await(const r of this){if(e(r,t))return!0;t++}return!1},e.every=async function(e){let t=0;for await(const r of this){if(!e(r,t))return!1;t++}return!0},e.find=async function(e){let t=0;for await(const r of this){if(e(r,t))return r;t++}}}(AsyncIteratorPolyfill||(AsyncIteratorPolyfill={})),installPolyfill({prototype:Object.getPrototypeOf(Object.getPrototypeOf(async function*(){}.prototype))},AsyncIteratorPolyfill),function(e){e.shift=function(e){return void 0!==e?async function*(){for(let t=0;t<e;t++)yield this.shift()}.apply(this):(async()=>(await this.next()).value)()}}(AsyncIteratorShiftPolyfill||(AsyncIteratorShiftPolyfill={})),installPolyfill({prototype:Object.getPrototypeOf(Object.getPrototypeOf(async function*(){}.prototype))},AsyncIteratorShiftPolyfill),function(e){const t=Symbol();e.map=function*(e){let t=0;for(const r of this)yield e(r,t),t++},e.filter=function*(e){let t=0;for(const r of this)e(r,t)&&(yield r),t++},e.take=function*(e){let t=0;for(const r of this){if(t>=e)break;yield r,t++}},e.drop=function*(e){let t=0;for(const r of this)t>=e&&(yield r),t++},e.flatMap=function*(e){let t=0;for(const r of this)yield*e(r,t),t++},e.reduce=function(e,r=t){let n=r,s=0;for(const r of this)n!==t?(n=e(n,r,s),s++):n=r;if(n===t)throw new TypeError("Must specify an initialValue if the iterable is empty.");return n},e.toArray=function(){const e=[];for(const t of this)e.push(t);return e},e.forEach=function(e){let t=0;for(const r of this)e(r,t),t++},e.some=function(e){let t=0;for(const r of this){if(e(r,t))return!0;t++}return!1},e.every=function(e){let t=0;for(const r of this){if(!e(r,t))return!1;t++}return!0},e.find=function(e){let t=0;for(const r of this){if(e(r,t))return r;t++}},e.toAsync=async function*(){yield*this}}(IteratorPolyfill||(IteratorPolyfill={})),installPolyfill({prototype:Object.getPrototypeOf(Object.getPrototypeOf(function*(){}.prototype))},IteratorPolyfill),function(e){e.shift=function(e){return void 0!==e?function*(){for(let t=0;t<e;t++)yield this.shift()}.apply(this):this.next().value}}(IteratorShiftPolyfill||(IteratorShiftPolyfill={})),installPolyfill({prototype:Object.getPrototypeOf(Object.getPrototypeOf(function*(){}.prototype))},IteratorShiftPolyfill),ObjectPolyfill||(ObjectPolyfill={}),installPolyfill(Object,ObjectPolyfill),function(e){e.groupBy=function(e,t){return e.reduce(((e,r,n)=>{var s;const o=t(r,n);return e[o]=[...null!==(s=e[o])&&void 0!==s?s:[],r],e}),{})},e.hasOwn=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(ObjectConstructorPolyfill||(ObjectConstructorPolyfill={})),installPolyfill({prototype:Object},ObjectConstructorPolyfill),function(e){function t(e){if(!function(e){if(null===e)return!1;const t=typeof e;return"object"===t||"function"===t}(e))throw new TypeError;const t=e.size,r=Number(t);if(Number.isNaN(r))throw new TypeError;if("function"!=typeof e.has)throw new TypeError;if("function"!=typeof e.keys)throw new TypeError}e.union=function(e){t(e);const r=new this.constructor(this);for(const t of e.keys())r.add(t);return r},e.intersection=function(e){let r,n;t(e),this.size<=e.size?(r=this,n=e):(r=e.keys(),n=this);const s=new this.constructor;for(const e of r)n.has(e)&&s.add(e);return s},e.difference=function(e){t(e);const r=new this.constructor(this);if(this.size<=e.size)for(const t of this)e.has(t)&&r.delete(t);else for(const t of e.keys())r.has(t)&&r.delete(t);return r},e.symmetricDifference=function(e){t(e);const r=new this.constructor(this);for(const t of e.keys())this.has(t)?r.delete(t):r.add(t);return r},e.isSubsetOf=function(e){t(e);for(const t of this)if(!e.has(t))return!1;return!0},e.isSupersetOf=function(e){t(e);for(const t of e.keys())if(!this.has(t))return!1;return!0},e.isDisjointFrom=function(e){if(t(e),this.size<=e.size){for(const t of this)if(e.has(t))return!1}else for(const t of e.keys())if(this.has(t))return!1;return!0}}(SetPolyfill||(SetPolyfill={})),installPolyfill(Set,SetPolyfill),function(e){function t(e){return function(t){const r=e.bind(this)(t);return this.clear(),r.forEach((e=>this.add(e))),this}}e.takeUnion=t(SetPolyfill.union),e.takeIntersection=t(SetPolyfill.intersection),e.takeDifference=t(SetPolyfill.difference),e.takeSymmetricDifference=t(SetPolyfill.symmetricDifference)}(InPlaceSetPolyfill||(InPlaceSetPolyfill={})),installPolyfill(Set,InPlaceSetPolyfill);class BasicTextDecoder{decode(e){let t="";for(let r=0;r<e.length;r+=32768)t+=String.fromCharCode(...e.subarray(r,r+32768));return t.replace(/[\xc0-\xff][\x80-\xbf]+|[\x80-\xff]/g,(function(e){const t=e.charCodeAt(0);let r=1114112,n=0,s="";switch(t>>>4){case 12:case 13:r=(31&t)<<6|63&e.charCodeAt(1),n=r<128?0:2;break;case 14:r=(15&t)<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2),n=r<2048?0:3;break;case 15:t>>>3==30&&(r=(7&t)<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|e.charCodeAt(3),n=r<65536?0:4)}for(n&&(e.length<n?n=0:r<65536?s=String.fromCharCode(r):r<1114112?(r-=65664,s=String.fromCharCode(55296+(r>>>10),56320+(1023&r))):n=0);n<e.length;n++)s+="�";return s}))}}function*range(e,t,r){var n;function s(t){return"bigint"==typeof e?BigInt(t):t}function o(e){return"string"==typeof e?e.charCodeAt(0):e}const[i,a]=void 0===t?[s(0),o(e)]:[o(e),o(t)],l=null!==(n=o(r))&&void 0!==n?n:s(1);let c=i;if(a<i)throw new RangeError("Range min cannot be greater than max");if("string"==typeof e)for(;c<=a;)yield String.fromCharCode(c),c+=l;else for(;c<a;)yield c,c+=l}!function(e){function t(e){return e?`[${Object.entries(e).map((([e,t])=>`${e}=${JSON.stringify(t)}`)).join(", ")}]`:""}e.label=Symbol("Graphviz.label"),e.children=Symbol("Graphviz.children"),e.attributes=Symbol("Graphviz.attributes"),e.text=function(t,r={}){return{...r,[e.label]:t}},e.serialize=function(r,{output:n}={}){const s=function*(){let e=0;for(;;)yield e++}(),o=new Map,i=[];i.push("digraph {"),function r(n,a,l){var c,u,f;if("object"!=typeof l||null===l)return;o.has(l)||o.set(l,`Node${s.shift()}`);const h=o.get(l),d=null!==(c=l[e.attributes])&&void 0!==c?c:{};e.label in l&&(d.label=l[e.label]),null!==(u=d.label)&&void 0!==u||(d.label=Symbol.toStringTag in l?l[Symbol.toStringTag]:Object.prototype.toString.apply(l)),i.push(`\t${h}${t(d)}`),null!=n&&i.push(`${n}->${h}${t({label:a})}`);const p=null!==(f=l[e.children])&&void 0!==f?f:Object.keys(l);for(const[e,t]of Object.entries(Array.isArray(p)?l:p))if(!Array.isArray(p)||p.includes(e))if(Array.isArray(t))for(const[n,s]of Array.entries(t))r(h,`${e}[${n}]`,s);else r(h,e,t)}(null,null,r),i.push("}");const a=i.join("\n");return"string"==typeof n&&system.writeTextFileSync(n,a),a}}(Graphviz||(Graphviz={}));class Token{constructor(e,t,r){this.name=e,this.value=t,this.pos=r}}class CFG{constructor(e,t,r){this.startingSymbol=e,this.rules=t,this.terminals=r}getTerminals(){return[...this.terminals]}getTerminalsAndEOF(){return[...this.terminals,CFG.EOF]}getNonTerminals(){return[...new Set(this.rules.keys())]}isStartingRule(e){return"string"!=typeof e?this.isStartingRule(e[0]):e===this.startingSymbol}static isTerminal(e){return!this.isEOF(e)&&!this.isLambda(e)&&e.toLowerCase()===e&&e.length>=1}static isTerminalOrEOF(e){return CFG.isEOF(e)||CFG.isTerminal(e)}static isEOF(e){return e===CFG.EOF}static isLambda(e){return e===CFG.LAMBDA_CHARACTER}static isNonTerminal(e){return!this.isEOF(e)&&!this.isLambda(e)&&e.toLowerCase()!==e&&e.length>=1}derivesToLambda(e,t=[]){var r;const n=this.rules;for(const s of null!==(r=n.get(e))&&void 0!==r?r:[]){if([...t].includes(s))continue;if(!s.length)return!0;if(s.some((e=>CFG.isTerminal(e))))continue;let e=!0;for(const r of s.filter((e=>CFG.isNonTerminal(e))))if(t.push(s),e=this.derivesToLambda(r,t),t.pop(),!e)break;if(e)return!0}return!1}firstSet([e,...t],r=new Set){var n;const s=this.rules;if(void 0===e)return[new Set,r];if(CFG.isTerminalOrEOF(e))return[new Set([e]),r];const o=new Set;if(!r.has(e)){r.add(e);for(const t of(null!==(n=s.get(e))&&void 0!==n?n:[]).map((t=>[e,t]))){const[n,s]=t,[i,a]=this.firstSet(this.startingSymbol===e?[...s,CFG.EOF]:s,r);o.takeUnion(i)}}if(this.derivesToLambda(e)&&t.length){const[e,n]=this.firstSet(t,r);o.takeUnion(e)}return[o,r]}followSet(e,t=new Set){const r=this.rules;if(t.has(e))return[new Set,t];t.add(e);const n=new Set;for(const s of[...r.entries()].flatMap((([t,r])=>r.flatMap((r=>r.includes(e)?[[t,r]]:[]))))){const[r,o]=s;for(const[s,i]of[...o.entries()].filter((([t,r])=>r===e))){const e=o.slice(s+1);if(e.length){const[t,r]=this.firstSet(e,new Set);n.takeUnion(t)}if(!e.length||e.every((e=>CFG.isNonTerminal(e)&&this.derivesToLambda(e)))){this.isStartingRule(r)&&n.add(CFG.EOF);const[e,s]=this.followSet(r,t);n.takeUnion(e)}}}return[n,t]}predictSet([e,t]){const r=this.firstSet(t)[0];return t.every((e=>this.derivesToLambda(e)))&&[...this.followSet(e)[0].values()].forEach((e=>r.add(e))),r}getRuleList(){return this.rules.entries().flatMap((([e,t])=>t.flatMap((t=>[[e,t]])))).toArray()}getRuleListFor(e){return this.rules.get(e).map((t=>[e,t]))}static makeUniqueNonTerminal(e,t,r="'"){for(;e.getNonTerminals().includes(t);)t+=r;return t}stringifyRule(e,t=!0){return t?`${e[0]} -> ${this.stringifyRule(e,!1)}`:(e[1].length?e[1].join(" "):CFG.LAMBDA_CHARACTER)+(this.isStartingRule(e)?" "+CFG.EOF_CHARACTER:"")}stringifySet(e){return`{${e.values().map((e=>e===CFG.EOF?CFG.EOF_CHARACTER:`'${JSON.stringify(e).slice(1,-1).replace(/'/g,"\\'").replace(/\\"/g,'"')}'`)).toArray().join(", ")}}`}static fromString(e,t=!0){var r;const n=Object.assign(Object.create(null),{ARROW:"->",UC_LAMBDA:CFG.LAMBDA_CHARACTER,LAMBDA:"lambda",OR:"|",EOF:CFG.EOF_CHARACTER}),s=[];for(const r of e.split("\n").map((e=>e.trim())))r.startsWith("#")&&t||s.push(...r.split(" ").filter((e=>e)));const o=new Map;let i=null;const a=new Set;for(;s.length;){const e=s.shift();if(s.shift()!==n.ARROW)throw new Error(`Expected '${n.ARROW}' after '${e}'!`);o.set(e,null!==(r=o.get(e))&&void 0!==r?r:[]);const t=o.get(e);let l;for(t.push(l=[]);s[1]!==n.ARROW&&s.length;){const r=s.shift();switch(r){case n.LAMBDA:case n.UC_LAMBDA:break;case n.EOF:if(null===i)i=e;else if(i!==e)throw new Error(`Multiple starting rules containing '${n.EOF}' found!`);break;case n.OR:t.push(l=[]);break;default:CFG.isTerminal(r)&&a.add(r),l.push(r)}}}if(null===i)throw new Error(`No starting rule containing '${n.EOF}' found!`);return new CFG(i,o,a)}}CFG.EOF=void 0,CFG.EOF_CHARACTER="$",CFG.LAMBDA_CHARACTER="λ",function(e){function t(...e){return!(("function"==typeof e[0]||void 0===e[0])&&(t=e[1],"object"==typeof t&&null!==t&&["kind","name"].every((e=>Object.hasOwn(t,e)))));var t}e.addLazyDecoratorSymbol=Symbol("addLazyDecorator"),e.invokeDefault=function(e,t,...r){return"class"===t.kind?new e(...r):e(...r)},e.decorator=function(r){return function(...n){if(t(...n))return(t,s)=>(null==t?void 0:t[e.addLazyDecoratorSymbol])?void t[e.addLazyDecoratorSymbol](r,n):r(t,s,...n);{const[t,s]=n;return(null==t?void 0:t[e.addLazyDecoratorSymbol])?void t[e.addLazyDecoratorSymbol](r,[]):r(t,s)}}},e.getPropertyDescriptor=function e(t,r){var n;if(null!=t)return null!==(n=Object.getOwnPropertyDescriptor(t,r))&&void 0!==n?n:e(Object.getPrototypeOf(t),r)}}(DecoratorFactory||(DecoratorFactory={}));const enumerable=DecoratorFactory.decorator(((e,t,r=!0)=>t.addInitializer((function(){Object.defineProperty(this,t.name,{...DecoratorFactory.getPropertyDescriptor(this,t.name),enumerable:r})}))));var Trees;!function(e){var t,r,n,s,o;class TreeInternals{}TreeInternals.treeLength=Symbol("Tree.treeLength"),TreeInternals.values=Symbol("Tree.values"),TreeInternals.at=Symbol("Tree.at"),TreeInternals.push=Symbol("Tree.push"),TreeInternals.unshift=Symbol("Tree.unshift"),TreeInternals.pop=Symbol("Tree.pop"),TreeInternals.shift=Symbol("Tree.shift"),TreeInternals.splice=Symbol("Tree.splice"),TreeInternals.iterator=Symbol("Tree.iterator"),TreeInternals.forEach=Symbol("Tree.forEach");class Tree extends TreeInternals{constructor(){super(...arguments),t.add(this),r.set(this,[]),n.set(this,void 0)}get parent(){return __classPrivateFieldGet(this,n,"f")}[(r=new WeakMap,n=new WeakMap,t=new WeakSet,s=function(e){return void 0!==e&&__classPrivateFieldSet(e,n,void 0,"f"),e},o=function(e){if(void 0===e)throw new Error("Cannot take ownership of undefined");if(e===this)throw new Error("Cannot take ownership of self");if(void 0!==e.parent)throw new Error("Cannot take ownership of a subtree");let t=this;do{if(t===e)throw new Error("Cannot take ownership of ancestor")}while(t=t.parent);return __classPrivateFieldSet(e,n,this,"f"),e},TreeInternals.push)](...e){return __classPrivateFieldGet(this,r,"f").push(...e.map((e=>__classPrivateFieldGet(this,t,"m",o).call(this,e))))}[TreeInternals.pop](){return __classPrivateFieldGet(this,t,"m",s).call(this,__classPrivateFieldGet(this,r,"f").pop())}[TreeInternals.unshift](...e){return __classPrivateFieldGet(this,r,"f").unshift(...e.map((e=>__classPrivateFieldGet(this,t,"m",o).call(this,e))))}[TreeInternals.shift](){return __classPrivateFieldGet(this,t,"m",s).call(this,__classPrivateFieldGet(this,r,"f").shift())}[TreeInternals.splice](e,n,...i){return __classPrivateFieldGet(this,r,"f").splice(e,n,...i.map((e=>__classPrivateFieldGet(this,t,"m",o).call(this,e)))).map((e=>__classPrivateFieldGet(this,t,"m",s).call(this,e)))}[TreeInternals.at](e){return __classPrivateFieldGet(this,r,"f").at(e)}get[TreeInternals.treeLength](){return __classPrivateFieldGet(this,r,"f").length}[TreeInternals.forEach](e,t){return void 0!==t&&(e=e.bind(t)),__classPrivateFieldGet(this,r,"f").forEach(((t,r)=>e(t,r,this)))}[TreeInternals.values](){return __classPrivateFieldGet(this,r,"f").values()}get[Symbol.toStringTag](){return this.constructor.name}[TreeInternals.iterator](){return __classPrivateFieldGet(this,r,"f")[Symbol.iterator]()}}e.Tree=Tree}(Trees||(Trees={}));var Tree=Trees.Tree;let ArrayTree=(()=>{var e,t;let r,n=Tree,s=[];return e=class ArrayTree extends n{constructor(){super(...arguments),this.at=(__runInitializers(this,s),super[Tree.at]),this.values=super[Tree.values],this.push=super[Tree.push],this.unshift=super[Tree.unshift],this.pop=super[Tree.pop],this.shift=super[Tree.shift],this.splice=super[Tree.splice],this[t]=super[Tree.iterator]}get length(){return super[Tree.treeLength]}get children(){return[...this]}},t=Symbol.iterator,(()=>{var t;const o="function"==typeof Symbol&&Symbol.metadata?Object.create(null!==(t=n[Symbol.metadata])&&void 0!==t?t:null):void 0;r=[enumerable],__esDecorate(e,null,r,{kind:"getter",name:"children",static:!1,private:!1,access:{has:e=>"children"in e,get:e=>e.children},metadata:o},null,s),o&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:o})})(),e})(),BinaryTree=(()=>{var e;let t,r,n=Tree,s=[];return e=class BinaryTree extends n{set left(e){this[Tree.splice](0,1,e)}get left(){return this[Tree.at](0)}set right(e){this[Tree.splice](1,1,e)}get right(){return this[Tree.at](1)}constructor(){super(...arguments),__runInitializers(this,s)}},(()=>{var o;const i="function"==typeof Symbol&&Symbol.metadata?Object.create(null!==(o=n[Symbol.metadata])&&void 0!==o?o:null):void 0;t=[enumerable],r=[enumerable],__esDecorate(e,null,t,{kind:"getter",name:"left",static:!1,private:!1,access:{has:e=>"left"in e,get:e=>e.left},metadata:i},null,s),__esDecorate(e,null,r,{kind:"getter",name:"right",static:!1,private:!1,access:{has:e=>"right"in e,get:e=>e.right},metadata:i},null,s),i&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:i})})(),e})();function createAsyncPeekableIterator(e){let t=e[Symbol.asyncIterator](),r=t.next();const n=async function*(){let e,n=!1;for(;!n;)({done:n,value:e}=await r),n||(r=t.next(),yield e)}();return n.peek=async function(){return(await r).value},n}function createPeekableIterator(e){let t=e[Symbol.iterator](),r=t.next();const n=function*(){let e,n=!1;for(;!n;)({done:n,value:e}=r),n||(r=t.next(),yield e)}();return n.peek=function(){return r.value},n}var LL1;!function(e){function t(e){const t=new Map;for(const r of e.getNonTerminals()){const n=new Set(e.getRuleListFor(r));t.set(r,[]);for(const[s,o,i]of n.values().map((e=>[...e,e]))){if(o.length<1){t.get(r).push(o);continue}const s=o[0],a=CFG.makeUniqueNonTerminal(e,r);let l=!1;for(const[e,r,i]of n.values().map((e=>[...e,e]))){const e=r[0];o!==r&&s===e&&(l||t.set(a,[]),l=!0,t.get(a).push(r.slice(1)),n.delete(i))}l?(t.get(a).push(o.slice(1)),t.get(r).push([s,a]),n.delete(i)):t.get(r).push(o)}}return new CFG(e.startingSymbol,t,new Set(e.getTerminals()))}function r(e){let r;do{r=e.getRuleList().length,e=t(e)}while(r!=e.getRuleList().length);return function(e){const t=new Map;function r(e,t){let r=[],n=-1;for(;e.at(n)===t.at(n)&&void 0!==e.at(n);)r.unshift(e.at(n--));return r}function n(e,t){return e.length===t.length&&e.every(((e,r)=>e===t[r]))}for(const s of e.getNonTerminals()){const o=new Set(e.getRuleListFor(s).sort((([e,t],[r,n])=>n.length-t.length)));t.set(s,[]);e:for(const[i,a,l]of o.values().map((e=>[...e,e]))){if(a[0]===i)for(const[i,c,u]of o.values().map((e=>[...e,e]))){if(a===c)continue;const i=r(a,c);if(n(c,i)){const r=a.slice(1,a.length-i.length);o.delete(l),o.delete(u);const n=CFG.makeUniqueNonTerminal(e,s);t.get(s).push([...i,n]),t.set(n,[[...r,...i,n],[]]);continue e}}t.get(s).push(a)}}return new CFG(e.startingSymbol,t,new Set(e.getTerminals()))}(e)}class LL1Parser{constructor(e,t=new Map){this.cfg=r(e),this.parseTable=function(e){const t=new Map(e.getNonTerminals().map((t=>[t,new Map(e.getTerminalsAndEOF().map((e=>[e,-1])))])));let r=0;for(const n of e.getNonTerminals()){const s=e.getRuleListFor(n).map((([e,t])=>t)),o=t.get(n);for(const t of s){const s=e.predictSet([n,t]);for(const e of s){if(-1!=o.get(e))throw new Error(`Grammar is not LL(1) (Caused by rules ${o.get(e)} and ${r})`);o.set(e,r)}r++}}return t}(this.cfg),this.sdt=t instanceof Map?t:new Map(Object.entries(t))}getCFG(){return this.cfg}getParseTable(){return this.parseTable}parse(e){var t,r,a,l,c,u,f,h,d,p,y;const m=this.parseTable,g=this.cfg.getRuleList(),b=createPeekableIterator(e),v=Symbol(),w=new n,S=[];let T,P=w;for(S.push(this.cfg.startingSymbol);S.length;){let e=S.pop();if(e===v){const e=P.parent,t=e.pop();let r=t;r===t&&this.sdt.has(t.name)&&(r=this.sdt.get(t.name)(t),void 0===r&&(r=t)),r===t&&this.sdt.has("*")&&(r=this.sdt.get("*")(t),void 0===r&&(r=t)),Array.isArray(r)?e.push(...r):null!=r&&e.push(r),P=e}else if(CFG.isNonTerminal(e)){let s=null!==(u=g[null!==(a=null===(t=m.get(e))||void 0===t?void 0:t.get(null===(r=b.peek())||void 0===r?void 0:r.name))&&void 0!==a?a:throws(new LL1Parser.SyntaxError(`Unexpected token ${null!==(c=null===(l=b.peek())||void 0===l?void 0:l.name)&&void 0!==c?c:"EOF"}`,T))])&&void 0!==u?u:throws(new LL1Parser.SyntaxError(`Syntax Error: Unexpected token ${null!==(h=null===(f=b.peek())||void 0===f?void 0:f.name)&&void 0!==h?h:"EOF"}`,T));S.push(v);const o=s[1];this.cfg.isStartingRule(s)&&S.push(CFG.EOF),o.length?S.push(...[...o].reverse()):S.push(CFG.LAMBDA_CHARACTER);const i=new n(e);P.push(i),P=P.at(-1)}else if(CFG.isTerminalOrEOF(e)){if(e!==(null===(d=b.peek())||void 0===d?void 0:d.name))throw new LL1Parser.SyntaxError(`Unexpected token ${null!==(y=null===(p=b.peek())||void 0===p?void 0:p.name)&&void 0!==y?y:"EOF"} expected ${e}`,T);e=b.shift(),T=null==e?void 0:e.pos,P.push(e instanceof Token?new i(e.name,e.value):new o)}else CFG.isLambda(e)&&P.push(new s)}if(1!==w.length)throw new LL1Parser.SyntaxError(void 0,T);return w.pop()}}e.LL1Parser=LL1Parser,function(e){class AbstractParseTree extends Tree{constructor(e){super(),this.name=e}}let t=(()=>{var e,t;let r,n=AbstractParseTree,s=[];return e=class ParseTreeNode extends n{constructor(e){super(e),this.at=(__runInitializers(this,s),super[Tree.at]),this.values=super[Tree.values],this.push=super[Tree.push],this.unshift=super[Tree.unshift],this.pop=super[Tree.pop],this.shift=super[Tree.shift],this.splice=super[Tree.splice],this[t]=super[Tree.iterator]}get parent(){return super.parent}get length(){return super[Tree.treeLength]}get children(){return[...this]}},t=Symbol.iterator,(()=>{var t;const o="function"==typeof Symbol&&Symbol.metadata?Object.create(null!==(t=n[Symbol.metadata])&&void 0!==t?t:null):void 0;r=[enumerable],__esDecorate(e,null,r,{kind:"getter",name:"children",static:!1,private:!1,access:{has:e=>"children"in e,get:e=>e.children},metadata:o},null,s),o&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:o})})(),e})();e.ParseTreeNode=t;e.ParseTreeLambdaLeaf=class ParseTreeLambdaLeaf extends AbstractParseTree{constructor(){super(CFG.LAMBDA_CHARACTER)}};e.ParseTreeEOFLeaf=class ParseTreeEOFLeaf extends AbstractParseTree{constructor(){super(CFG.EOF_CHARACTER)}};e.ParseTreeTokenLeaf=class ParseTreeTokenLeaf extends AbstractParseTree{constructor(e,t){super(e),this.value=t}};class SyntaxError extends Error{constructor(e,t){super(e),this.pos=t}}e.SyntaxError=SyntaxError}(LL1Parser=e.LL1Parser||(e.LL1Parser={}));var n=LL1Parser.ParseTreeNode,s=LL1Parser.ParseTreeLambdaLeaf,o=LL1Parser.ParseTreeEOFLeaf,i=LL1Parser.ParseTreeTokenLeaf}(LL1||(LL1={}));var RegexEngine,AlphabetEncoding,LL1Parser=LL1.LL1Parser;!function(e){let t;!function(e){e.NFAContext=class NFAContext{constructor(e){this.alphabet=e,this.iter=function*(e=0){for(;;)yield e++}()}createState(){return this.iter.shift()}createStates(e=1){return[...this.iter.shift(e)]}lambdaWrap(e){const[t,r]=this.createStates(2);return{start:t,end:r,edges:[[t,e.start],...e.edges,[e.end,r]]}}}}(t||(t={}));var r=t.NFAContext;let n;!function(e){var t,r;class RegexNode extends Tree{constructor(){super(...arguments),this.name=this.constructor.name}}e.RegexNode=RegexNode;e.AltNode=class AltNode extends RegexNode{constructor(e){super(),this.nodes=e}getChildNodes(){return[...this.nodes]}clone(){return new this.constructor(this.nodes.map((e=>e.clone())))}toNFA(e){const[t,r]=e.createStates(2),n={start:t,end:r,edges:[]};for(const s of this.nodes[Symbol.iterator]().map((t=>t.toNFA(e))))n.edges.push([t,s.start]),n.edges.push(...s.edges),n.edges.push([s.end,r]);return e.lambdaWrap(n)}};e.SeqNode=class SeqNode extends RegexNode{constructor(e){super(),this.nodes=e}getChildNodes(){return[...this.nodes]}clone(){return new this.constructor(this.nodes.map((e=>e.clone())))}toNFA(e){const[t,r]=e.createStates(2),n={start:t,end:r,edges:[]};let s=n.start;for(const t of this.nodes[Symbol.iterator]().map((t=>t.toNFA(e))))n.edges.push([s,t.start]),n.edges.push(...t.edges),s=t.end;return n.edges.push([s,n.end]),e.lambdaWrap(n)}};class RangeNode extends RegexNode{constructor(e,t){super(),this.min=e,this.max=t}get[Graphviz.children](){return{min:Graphviz.text(this.min),max:Graphviz.text(this.max)}}clone(){return new this.constructor(this.min,this.max)}toNFA(e){const[t,r]=e.createStates(2);return e.lambdaWrap({start:t,end:r,edges:range(this.min,this.max).filter((t=>e.alphabet.has(t))).map((e=>[t,r,e])).toArray()})}}e.RangeNode=RangeNode;t=Graphviz.label,e.KleenNode=class KleenNode extends RegexNode{constructor(e){super(),this.node=e,this[t]="*"}clone(){return new this.constructor(this.node.clone())}toNFA(e){const t=e.createState(),r={start:t,end:t,edges:[]},n=this.node.toNFA(e);return r.edges.push([t,n.start]),r.edges.push(...n.edges),r.edges.push([n.end,t]),e.lambdaWrap(r)}};class CharNode extends RegexNode{constructor(e){super(),this.char=e}get[Graphviz.label](){return this.char}clone(){return new this.constructor(this.char)}toNFA(e){const[t,r]=e.createStates(2);return e.lambdaWrap({start:t,end:r,edges:[[t,r,this.char]]})}}e.CharNode=CharNode;e.WildcharNode=class WildcharNode extends RegexNode{clone(){return new this.constructor}toNFA(e){const[t,r]=e.createStates(2);return e.lambdaWrap({start:t,end:r,edges:e.alphabet.values().map((e=>[t,r,e])).toArray()})}};r=Graphviz.label,e.LambdaNode=class LambdaNode extends RegexNode{constructor(){super(...arguments),this[r]=CFG.LAMBDA_CHARACTER}clone(){return new this.constructor}toNFA(e){const[t,r]=e.createStates(2);return e.lambdaWrap({start:t,end:r,edges:[[t,r]]})}}}(n||(n={}));var s=n.RegexNode;const o=CFG.fromString((new BasicTextDecoder).decode(new Uint8Array([83,32,45,62,32,82,101,103,101,120,32,36,13,10,13,10,82,101,103,101,120,32,45,62,32,65,108,116,101,114,110,97,116,105,111,110,13,10,13,10,65,108,116,101,114,110,97,116,105,111,110,32,45,62,32,65,108,116,101,114,110,97,116,105,111,110,32,37,124,32,83,101,113,117,101,110,99,101,13,10,32,32,32,32,32,32,32,32,32,32,32,32,124,32,83,101,113,117,101,110,99,101,13,10,83,101,113,117,101,110,99,101,32,45,62,32,83,101,113,117,101,110,99,101,32,81,117,97,110,116,105,102,105,101,114,32,124,32,206,187,13,10,32,32,32,32,32,32,32,32,32,32,32,32,124,32,81,117,97,110,116,105,102,105,101,114,13,10,81,117,97,110,116,105,102,105,101,114,32,45,62,32,80,114,105,109,97,114,121,32,37,42,13,10,32,32,32,32,32,32,32,32,32,32,32,32,124,32,80,114,105,109,97,114,121,32,37,43,13,10,32,32,32,32,32,32,32,32,32,32,32,32,124,32,80,114,105,109,97,114,121,13,10,13,10,80,114,105,109,97,114,121,32,45,62,32,80,114,105,109,105,116,105,118,101,32,124,32,37,40,32,82,101,103,101,120,32,37,41,13,10,80,114,105,109,105,116,105,118,101,32,45,62,32,99,104,97,114,32,124,32,99,104,97,114,32,37,45,32,99,104,97,114,32,124,32,37,46]))),i=new LL1Parser(o,new Map(Object.entries({"*":e=>1===e.length?e.at(0)instanceof LL1Parser.ParseTreeLambdaLeaf?null:e.pop():e.name.endsWith("'")?e.splice(0,e.length):void 0,Primitive(e){const[t,,r]=[...e];return"char"===t.name&&"char"===(null==r?void 0:r.name)?new n.RangeNode(t.value,r.value):"char"===t.name?new n.CharNode(t.value):"%."===t.name?new n.WildcharNode:void 0},Sequence:e=>1===e.length?e.shift():new n.SeqNode([...e].flatMap((e=>e instanceof n.SeqNode?e.getChildNodes():[e]))),Alternation(e){const t=e.length,r=e.splice(0,e.length).filter((e=>e instanceof s));return 2*r.length-1!==t&&r.push(new n.LambdaNode),new n.AltNode(r)},Quantifier(e){const t=e.at(1);if(t instanceof LL1Parser.ParseTreeTokenLeaf)switch(t.name){case"%+":return new n.SeqNode([e.at(0),new n.KleenNode(e.shift().clone())]);case"%*":return new n.KleenNode(e.shift())}},Primary:e=>1===e.length?e.shift():e.splice(1,1),S:e=>e.shift()})));function a(e){return e.split("").every((e=>"0123456789abcdef".includes(e.toLowerCase())))}function*l(e){const t=e[Symbol.iterator]();let r,n=0,s=1;for(;void 0!==(r=t.shift());){switch(r){case"\\":{const e=t.shift();switch(e){case"\\":case"(":case")":case"+":case"*":case"-":case".":case"|":yield new Token("char",e,{line:s,col:n});break;case"s":yield new Token("char"," ",{line:s,col:n});break;case"n":yield new Token("char","\n",{line:s,col:n});break;case"u":const r=t.take(4).toArray().join(""),o=Number.parseInt(r,16);if(4!=r.length||!a(r)||Number.isNaN(o))throw new Error(`Invalid unicode escape sequence '\\u${r}'`);yield new Token("char",String.fromCharCode(o),{line:s,col:n});break;default:throw new Error(`Unknown escape sequence '\\${e}'`)}break}case"(":case")":case"+":case"*":case"-":case".":case"|":yield new Token("%"+r,r,{line:s,col:n});break;default:yield new Token("char",r,{line:s,col:n})}"\n"===r&&s++,n++}}e.tokenize=l,e.parse=function(e){return i.parse(l(e))},e.compile=function(t,n){const s=new r(new Set(n)),[o,i]=s.createStates(2),a=e.parse(t).toNFA(s);return{start:o,end:i,edges:[[o,a.start],...a.edges,[a.end,i]]}}}(RegexEngine||(RegexEngine={})),function(e){e.decode=function(e){return null==e?void 0:e.replace(/x.{0,2}/g,(function(e){const t=+`0${e}`;if(Number.isNaN(t))throw new Error(`'${e}' is not a valid escape sequence!`);return String.fromCharCode(t)}))},e.encode=function(e,t=!1){function r(e){return`x${e.charCodeAt(0).toString(16).padStart(2,"0")}`}return t?e[Symbol.iterator]().map(r).toArray().join(""):null==e?void 0:e.replace(/[^0-9A-Za-wy-z]/g,r)}}(AlphabetEncoding||(AlphabetEncoding={}));const{decode:alphaDecode,encode:alphaEncode}=AlphabetEncoding,IO_ERROR=1,SYNTAX_ERROR=2,SEMANTIC_ERROR=3;system.args.slice(1).length<1&&(console.error("Error: Expected at least one argument!"),system.exit());const[lexFile,outFile]=system.args.slice(1),lines=function(){var e;try{return((null===(e=system.readTextFileSync(lexFile))||void 0===e?void 0:e.trim())||throws(new Error("No text!"))).split(/\r?\n/g)}catch(e){console.error("IO Error"+(e.message?`: ${e.message}`:"")),system.exit(1)}}(),alphabet=lines.shift().split(/\s+/g).flatMap((e=>alphaDecode(e).split("")));console.log(`Alphabet: ${alphabet.map((e=>alphaEncode(e))).join(" ")}`);const uFileOutput=[];uFileOutput.push(alphabet.map((e=>alphaEncode(e))).join(" "));const lambdaCharacter=function(e){for(const t of range(String.fromCharCode(1),String.fromCharCode(127)))if(!e.has(t))return t;console.error("Error: No sutible lambda ascii character found!"),system.exit(8)}(new Set(alphabet));console.log(`Chose ${alphaEncode(lambdaCharacter)} for lambda`);for(const e of lines){const[t,r,n]=e.split(/\s+/g);console.log(`Compiling ${r}...`);const s=function(){try{return RegexEngine.compile(t,alphabet)}catch(e){e instanceof LL1Parser.SyntaxError&&(console.error(`Syntax Error${e.message?`: ${e.message}`:""}${e.pos?` at ${e.pos.line}:${e.pos.col}`:""}`),system.exit(2)),console.error("Semantic Error"+(e.message?`: ${e.message}`:"")),system.exit(3)}}();uFileOutput.push(`${r}.tt ${r} ${null!=n?n:""}`.trim());try{const e=[];e.push(`${s.edges.length} ${alphaEncode(lambdaCharacter)} ${alphabet.map((e=>alphaEncode(e))).join(" ")}`);for(const t of s.edges)e.push(`${1===t[1]?"+":"-"} ${t[0]} ${t[1]} ${alphaEncode(null!==(_f=t[2])&&void 0!==_f?_f:lambdaCharacter)}`);system.writeTextFileSync(`${r}.nfa`,e.join("\n"))}catch(e){console.error("IO Error"+(e.message?`: ${e.message}`:"")),system.exit(1)}}try{system.writeTextFileSync(null!=outFile?outFile:lexFile.replace(/\.[^.]+$/g,".u"),uFileOutput.join("\n"))}catch(e){console.error("IO Error"+(e.message?`: ${e.message}`:"")),system.exit(1)}