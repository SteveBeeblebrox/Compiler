#!/home/siana/.nvm/versions/node/v21.5.0/bin/node
var _a,_b,_c,_d,_e,__awaiter=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))};class LanguageDefinition{constructor(e=[],t=[]){this.alphabet=e,this.tokenTypes=t}}class TokenType{constructor(e,t,n){this.name=e,this.table=t,this.value=n}}fs=require("fs");const system={args:process.argv.slice(1),exit:process.exit,readFile:e=>fs.readFileSync(e,{encoding:"utf8"}),writeFile(e,t){fs.writeFileSync(e,t,{encoding:"utf8"})},createFileReadStream(e){return __awaiter(this,void 0,void 0,(function*(){const t=fs.createReadStream(e,{encoding:"utf8"});return yield new Promise((function(e,n){t.on("readable",e),t.on("error",e)})),t}))},createFileWriteStream(e){return __awaiter(this,void 0,void 0,(function*(){return fs.createWriteStream(e,{encoding:"utf8"})}))}};var AlphabetEncoding;null!==(_a=Object.groupBy)&&void 0!==_a||(Object.groupBy=function(e,t){return e.reduce(((e,n,r)=>{var i;const o=t(n,r);return e[o]=[...null!==(i=e[o])&&void 0!==i?i:[],n],e}),{})}),null!==(_b=(_d=Array.prototype).flat)&&void 0!==_b||(_d.flat=function e(t=1){return t?Array.prototype.reduce.call(this,(function(n,r){return Array.isArray(r)?n.push.apply(n,e.call(r,t-1)):n.push(r),n}),[]):Array.prototype.slice.call(this)}),null!==(_c=(_e=Array.prototype).flatMap)&&void 0!==_c||(_e.flatMap=function(e,t){return Array.prototype.map.call(this,e,t).flat()}),function(e){e.decode=function(e){return null==e?void 0:e.replace(/x.{0,2}/g,(function(e){const t=+`0${e}`;if(Number.isNaN(t))throw new Error(`'${e}' is not a valid escape sequence!`);return String.fromCharCode(t)}))},e.encode=function(e){return null==e?void 0:e.replace(/[^0-9A-Za-wy-z]/g,(function(e){return`x${e.charCodeAt(0).toString(16)}`}))}}(AlphabetEncoding||(AlphabetEncoding={}));const{decode:alphaDecode,encode:alphaEncode}=AlphabetEncoding;function readLanguageDefinition(e){const t=system.readFile(e).trim();if(!t)throw new Error(`${e} is empty!`);const n=new LanguageDefinition,[r,...i]=t.split("\n").map((e=>e.trim()));n.alphabet=alphaDecode(r.replace(/\s+/g,"")).split("");for(const e of i){if(!e||e.startsWith("#"))continue;const[t,r,i]=e.split(/\s+/g);n.tokenTypes.push(new TokenType(r,readTokenTable(t),alphaDecode(i)))}return n}function readTokenTable(e){const t=system.readFile(e).trim();if(!t)throw new Error(`${e} is empty!`);const n=[];for(const e of t.split("\n").map((e=>e.trim()))){if(!e||e.startsWith("#"))continue;const[t,r,...i]=e.split(/\s+/g);n[+r]={accepting:"+"===t,data:i.map((e=>"E"===e?null:+e))}}return n}!function(){__awaiter(this,void 0,void 0,(function*(){const[e,t,n]=system.args.slice(1);console.log(readLanguageDefinition(e));const r=yield system.createFileReadStream(t),i=yield system.createFileWriteStream(n);let o;for(;o=r.read(1);)i.write(o)}))}();